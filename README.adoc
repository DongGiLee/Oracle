= Oracle Study
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 3
:sectlinks:

- - -

REFR::
link:https://www.youtube.com/watch?v=aDTiSKcMtoc&list=PLq8wAnVUcTFVq7RD1kuUwkdWabxvDGzfu&index=2[newlecture]

Access Program::
. SQL Plus :
.. ID : sys as sysdba
.. PW : [PW]

. SQL Developer

== Getting Started

[upperroman]
. Search list of PDB after sqlplush accessing after running the terminal

+

[source,bash]
----
sqlplus sys as sysdba
----

+

[source,sql]
----
select name from v$pdbs;
----

+
.PDBS 목록 조회
image::src/img/getting_started_1.png[terminal]

. Start SQL Developer

+

.pdb 접속
image::src/img/getting_started_2.png[SQL Developer]
pdb 계정은 cdb 계정과 다른계정이다.


. Allow remote access

+

[source, sql]

----
EXEC DBMS_XDB.SETLISTENERLOCALACCESS(FALSE);
----
.관리자 저장 프로시저
image::src/img/getting_started_3.png[관리자 저장 프로시저]

. Setting DBA of PDB schema

.. "접속"탭 PDB -> 보기 -> DBA

+

image::src/img/getting_started_4_1.png[1]

.. PDB 선택

+

image::src/img/getting_started_4_2.png[2]


.. "DBA"탭 -> 저장 영역 -> 테이블스페이스 -> 새로만들기

+

image::src/img/getting_started_4_3.png[3]



.. 저장용 Table 생성

+

.유형 영구, 파일크기 500MB, 최대크기 2GB
image::src/img/getting_started_4_4.png[4]


.. 임시 로그 Table 생성

+

.유형 임시, 파일크기 500MB, 최대크기 2GB
image::src/img/getting_started_4_5.png[5]


. Create user for tablespace

.. "DBA"탭 -> 보안 영역 -> 사용자 -> 새로만들기

+

image::src/img/getting_started_5_1.png[사용자만들기]


.. Set User info

+

image::src/img/getting_started_5_2.png[기본설정]

+

TIP: 사용자명 대문자로 지정, 소문자로 할경우 `" "` 로 지정해줘야하는 번거로움이 생김


.. Set User Permissions

+

image::src/img/getting_started_5_3.png[권한설정]

+

.일반사용자 권한을 벗어난 목록들 체크해제
* [ ] SYSKM
* [ ] SYSOPER
* [ ] SYSRAC 

.. Connect as created user

+

image::src/img/getting_started_5_4.png[새 사용자로 접속]




== Concept

=== Pluggable
[#CDB-PDB]
.CDB & PDB
image::src/img/pdb.png[CDB]

CDB:: Container DB +
물리적인 DB이다.

PDB:: Pluggable DB +
CDB안에 Seed로 만들어지는 가상화 DB이다.

PDB$SEED:: PDB의 원본 +
인터페이스같은 역할

XEPDB1:: SEED로 생성한 실제 PDB의 이름 (현재이름, 가변적), 

+

[source,sql]
.PDB 목록 확인하는 쿼리문
----
SELECT name FROM v$pdbs;
----

DUAL Table::
값을 뽑아내야하지만 구문상 Table을 조회해야할경우 사용할수있는 임시 테이블, 더미테이블이다.


== Query

=== DDL
    Data Definition Language
    데이터 정의어

==== CREATE
Ex)::
[source,sql]
----
CREATE TABLE MEMBER (
    ID          VARCHAR2(50),
    PWD         NVARCHAR2(50),
    NAME        NVARCHAR2(50),
    GENDER      NCHAR(2), -- 남성, 여성
    AGE         NUMBER(3),
    BIRTHDAY    CHAR(10), -- 2000-01-02
    PHONE       CHAR(13), -- 010-1243-4567
    REGDATE     DATE
);
----

==== ALTER
. 수정

+ 
[source,sql]
.ID를 VARCHAR -> NVARCHAR로 수정
----
ALTER TABLE MEMBER MODIFY ID NVARCHAR2(50);
----


. 삭제

+

[source,sql]
.AGE 컬럼을 삭제
----
ALTER TABLE MEMBER DROP COLUMN AGE;
----

. 추가

+

[source,sql]
.EMAIL 컬럼 추가
----
ALTER TABLE MEMBER ADD EMAIL VARCHAR2(200);
----


==== DROP

=== DML
    Data Manipulation Language
    데이터 조작어

==== INSERT

명령 규칙::

+

[source,sql]
.기본
----
INSERT INTO <테이블> VALUES <값 목록>
----

+

[source,sql]
.원하는 필드만 입력
----
INSERT INTO(col1,col2) VALUES(val1, val2);
----

IMPORTANT: VALUES 안에 데이터를 넣을때 `""`(쌍 따옴표) 가 아닌 `''` (따옴표) 를 넣어야한다.

==== SELECT

==== UPDATE
명령규칙::

+

[source,sql]
.모든행 수정
----
UPDATE <테이블> SET col=new_val;
----

+

[source,sql]
.특정행 수정
----
UPDATE <테이블> SET col=new_val [, ...] WHERE col=origin_val;
----


==== DELETE
명령규칙::

+

[source,sql]
.특정행 삭제
----
DELETE <테이블> WHERE col=val;
----

=== DCL
    Data Control Language
    데이터를 사용할수 있는 권한

==== GRANT
==== REVOKE

=== TCL
    Transaction Control Language
    트랜젝션; 업무 실행단위, 논리적인 실행 (작업 수행) 단위



Oracle은 모든수행이 기본적으로 임시저장소로 가게된다. +
그래서 한 Session에서 `INSERT`, `DELETE`, `UPDATE` 등 수행해도 다른 Session에서 `SELECT` 을 해도 변경된값이 조회가 안되는게 그이유에서 이다. +

그래서 마지막에 `COMMIT` 을 해야지 물리적인 저장소로 이동을하게된다.

LOCK::
현재 `COMMIT` , `ROLLBACK` 을 하기전 다른 Session 에서 사용중이라면 `LOCK` 이걸려서 데이터를 조작할수없다.

==== COMMIT

==== ROLLBACK

==== SAVEPOINT


== DATA TYPE

=== Character
Ex)::
'hINice' +
'A' +
'148'

==== CHAR
고정길이 문자열일때 사용

MAX SIZE::
. STANDARD : 4000 Byte
. EXTENDED : 32767 Byte


==== VARCHAR2
가변길이 문자열일때 사용

NOTE: **CHAR vs VARCHAR2** +
모든 문자열을 `VARCHAR2` 로하면 효율적이지않음? +
`VARCHAR2` 형식에 문자열은 메모리상에 `,` 로 구분하기때문에 +
검색속도가 `CHAR` 자료형에 비해 느리다.

==== NCHAR
National Character +
다양한 나라의 언어를 사용할때 붙힌다. +
더많은 byte를 사용한다. 

==== NVARCHAR2
위와 동일하다.

TIP: **CHAR 한글 사이즈?** +
한글은 1Byte 아니고 3Byte 이기떄문에 ex)_ CHAR(2) -- 남성, 여성 +
데이터 입력시 사이즈 에러가 뜬다. +
해결방안으로 CHAR(2 CHAR)로 글자수를 지정해주거나 + 
NCHAR(2)로 다국어 처리를 해줄수있다. +
즉, **CHAR(2 CHAR) == NCHAR(2)**

=== Numeric
Ex)::
38 + 
3.85 +
3.85F +
137

정수, 실수 둘다 NUMBER로 사용한다.

NUMBER(4):: 최대 4자로 이루어진 숫자

NUMBER(6,2):: 소수점 2자리를 포함하는 최대 6자리
NUMBER(6,-2):: 소수점 -2자리에서 반올림하는 최대 6자리의 숫자
NUMBER:: NUMBER(38,*)
NUMBER(*,5):: NUMBER(38,5)



=== Date

기본적으로 숫자형식이다.

Ex)::
'2013-02-09'

+

[source,sql]
.지역정보 확인하는 쿼리
----
SELECT * FROM NLS_DATABASE_PARAMETERS;
----

==== DATE
년 월 일 표시할수있다. +
4712 BC~9999 AD +

Ex)::
01-JAN-99

==== TIMESTAMP

NLS_TIMESTAMP_FORMAT 파라미터에 명시된 값을 따름.

==== TIMESTAMP WITH TIME ZONE
NLS_TIMESTAMP_TZ_FORMAT 파라미터에 명시된 값을 따름

==== TIMESTAMP WITH LOCAL TIME ZONE
NLS_TIMESTAMP_FORMAT 파라미터에 명시된 값을 따름.


'2013-06-03 10.38.29.00000'

=== LOB

==== LONG
최대 2Gbyte +
요즘은 잘사용하지않음 +
CLOB가 대체됨

==== CLOB
대용량 텍스트 데이터 타입 (최대 4Gbyte)

==== NCLOB
대용량 텍스트 유니코드 데이터 타입 (최대 4Gbyte)


== Operator

=== Arithmetic

==== `+`
다른 DBMS에서는 `+` 를 문자형이나 숫자형 둘다 사용가능하지만 Oracle에서는 숫자형에서만 사용할수있다.

Ex)::

+

[source,sql]
.숫자형 , 문자형
----
SELECT 1 + '4' FROM DUAL;
----

+

[source,sql]
.result
----
5
----

+

다른 DBMS에서는 저값이 `"14"` 로(문자형) 나오지만 Oracle은 숫자형에서 밖에 `+` 를 사용하지않기때문에 숫자형으로 변환되어 나온다.

==== `||`
문자열 더하기 연산자

Ex)::

+

[source,sql]
.숫자형 , 문자형
----
SELECT 1 || '5' FROM DUAL;
----

+

[source,sql]
.result
----
"15"
----

=== Comparison

==== `!=` `^=` `<>`
같지 않을때 사용 +
`!=` 다른곳에서 다들 사용하기때문에 Oracle에서 사용한다. +
`^=` Oracle용 연산자 +
`<>` 표준 연산자

=== Relational

==== BETWEEN
EX)::
조회수가 0,1,2 인 게시글을 조회하시오.

+

[source,sql]
.AND 버전
----
SELECT * FROM NOTICE WHERE 0<= HIT AND HIT <=2;
----

+

[source,sql]
.BETWEEN 버전
----
SELECT * FROM NOTICE WHERE HIT BETWEEN 0 AND 2;
----

==== IN

EX)::
조회수가 0,2,7 인 게시글을 조회하시오.

+

[source,sql]
.OR 버전
----
SELECT * FROM NOTICE WHERE HIT=0 OR HIT=2 OR HIT=7;
----

+

[source,sql]
.IN 버전
----
SELECT * FROM NOTICE WHERE HIT IN (0,2,7);
----

=== Pattern

==== LIKE

==== `%`
Ex)::
회원중에 '박'씨 성을 조회하시오.
+

[source,sql]
----
SELECT * FROM MEMBER WHERE NAME='박%' ;
----
==== `_`

== CURRENT SCHEMA

[source,sql]
.MEMBER
----
CREATE TABLE "MEMBER" 
   (	"ID"        NVARCHAR2(50), 
        "PWD"       NVARCHAR2(50), 
        "NAME"      NVARCHAR2(50), 
        "GENDER"    NCHAR(2), 
        "BIRTHDAY"  CHAR(10 BYTE), 
        "PHONE"     CHAR(13 BYTE), 
        "REGDATE"   DATE, 
        "EMAIL"     VARCHAR2(200 BYTE)
   );
----

[source,sql]
.NOTICE
----
CREATE TABLE "NOTICE" (
    ID          NUMBER,
    TITLE       NVARCHAR2(100),
    WRITER_ID   NVARCHAR2(50),
    CONTENT     CLOB,
    REGDATE     TIMESTAMP,
    HIT         NUMBER,
    FILES       NVARCHAR2(1000)
);
----

[source,sql]
.COMMENT
----
CREATE TABLE "COMMENT" (
    ID          NUMBER,
    CONTENT     NVARCHAR2(50),
    REGDATE     TIMESTAMP,
    WRITER_ID   NVARCHAR2(50),
    NOTICE_ID   NUMBER
);
----
[source,sql]
.ROLE
----
CREATE TABLE "ROLE"(
    ID          VARCHAR2(50),
    DISCRIPTION NVARCHAR2(500)
);
----
[source,sql]
.MEMBER_ROLE
----
CREATE TABLE MEMBER_ROLE(
    MEMBER_ID   NVARCHAR2(50),
    ROLE_ID     VARCHAR2(50)
);
----